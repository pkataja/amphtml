let currentYear=(new Date).getFullYear(),boatlist=new Array,csvData,csvHeader,tablejsonData,orcBoats=0,dhBoats=0,nsBoats=0,tableBoats=0,orcFetched=0,tableFetched=0;async function getCVSData(a){a=await a.text();(csvData=Papa.parse(a)).data.forEach(function(a,n){if(0<n&&""!=a[0]){var i=new Map;let t=a[0].replace(".dxt","");var e=tablejsonData.find(([,a])=>a.BIN===t)[1];i.FIN_FinRating_TOT=e.FIN_FinRating_TOT,i.FIN_FinRating_H_TOT=e.FIN_FinRating_H_TOT,i.FIN_FinRating_L_TOT=e.FIN_FinRating_L_TOT,i.CDL=e.CDL,i.FIN_FinRating_TOD=e.FIN_FinRating_TOD,i.FIN_FinRating_H_TOD=e.FIN_FinRating_H_TOD,i.FIN_FinRating_L_TOD=e.FIN_FinRating_L_TOD,i.CrewWT=a[11],i.C_TYPE="TABLE",i.TYPE=a[2],i.FILE_ID=a[0],i.SAILNUMB="",i.NAME="",i.index=n,boatlist.push(i),a.push(i.FIN_FinRating_TOT),a.push(i.FIN_FinRating_H_TOT),a.push(i.FIN_FinRating_L_TOT),a.push(i.CDL),a.push(i.FIN_FinRating_TOD),a.push(i.FIN_FinRating_H_TOD),a.push(i.FIN_FinRating_L_TOD)}0===n&&(a.push("FIN_FinRating_TOT"),a.push("FIN_FinRating_H_TOT"),a.push("FIN_FinRating_L_TOT"),a.push("CDL"),a.push("FIN_FinRating_TOD"),a.push("FIN_FinRating_H_TOD"),a.push("FIN_FinRating_L_TOD"),csvHeader=a)}),tableBoats=csvData.data.length-1}function getJsonData(i){i.rms.forEach(a=>{var t=new Map,n=(t.FIN_FinRating_TOT=a.FIN_FinRating_TOT,t.FIN_FinRating_H_TOT=a.FIN_FinRating_H_TOT,t.FIN_FinRating_L_TOT=a.FIN_FinRating_L_TOT,t.CDL=a.CDL,t.CrewWT=a.CrewWT,a.C_Type);t.C_TYPE=n,t.TYPE=a.Class,t.FILE_ID=a.RefNo,t.SAILNUMB=a.SailNo,t.NAME=a.SailNo,boatlist.push(t),"INTL"!==n&&"CLUB"!==n||++orcBoats,"DHIN"!==n&&"DHCL"!==n||(dhBoats=i.rms.length),"HSIN"!==n&&"NSCL"!==n||(nsBoats=i.rms.length)})}console.log("orc"),Promise.all([fetch("https://data.orc.org/public/WPub.dll?action=DownRMS&CountryId=FIN&ext=json&family=1&VPPYear="+currentYear),fetch("https://data.orc.org/public/WPub.dll?action=DownRMS&CountryId=FIN&ext=json&family=3&VPPYear="+currentYear),fetch("https://data.orc.org/public/WPub.dll?action=DownRMS&CountryId=FIN&ext=json&family=5&VPPYear="+currentYear)]).then(a=>Promise.all(a.map(a=>a.json()))).then(a=>{a.forEach(async a=>{getJsonData(a),console.log("orc"),orcFetched=1})}),console.log("table"),fetch("https://ampranking.s3.eu-north-1.amazonaws.com/2025/FinnishClass.json").then(a=>a.json()).then(a=>{tablejsonData=Array.from(a.rms.entries()),fetch("https://ampranking.s3.eu-north-1.amazonaws.com/2025/FIN_table25.csv").then(a=>{getCVSData(a),console.log("table"),tableFetched=1,reloadTable()})}),console.log("fetch");