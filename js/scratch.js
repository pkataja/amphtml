let boats=new Map,existingIDs=[],sailTimesLength=0,currentDefaultBoat="",currentIDHMS,inputTableJS,lystableJS=void 0,sailTimesArray=new Array,maxNameWidth,pagingType,showtime=!1;function startup(){maxNameWidth=window.getComputedStyle(document.body).getPropertyValue("--max-name-width"),pagingType=window.getComputedStyle(document.body).getPropertyValue("--paging-type"),createLystable(),$("#lystable tbody").on("click","tr",function(){addBoat(boatlist[$(this)[0]._DT_RowIndex])}),$("#createExcel").click(function(){createExcel()}),$("#instructions").click(function(){alert("TBD")}),$("#toggle").click(function(){doToggle()}),$("#defaultTimes").click(function(){putDefaultTimes(),updateInputs()}),$(document).on("change","input[type=radio][name=defaultBoat]",function(t){updateInputs()}),$(document).on("click","td[name=sailtimeCh]",function(t){changeASailTime()}),putDefaultTimes()}function doToggle(){let t="N채yt채 aika";(showtime=!showtime)||(t="N채yt채 erotus"),$("#toggle").html(t),console.log(showtime),updateInputs()}function createLystable(){lystableJS=$("#lystable").DataTable({data:boatlist,columns:[{data:"TYPE",title:"Tyyppi"},{data:"FIN_FinRating_TOT",title:"FR"},{data:"C_TYPE",title:""},{data:"NAME",title:"Nimi"},{data:"SAILNUMB",title:"Purjenro"}],responsive:!1,paging:!0,pageLength:8,language:{search:"Hae veneit&auml;:&nbsp;&nbsp;",paginate:{first:"<<",next:">",previous:"<",last:">>"},lengthMenu:"",zeroRecords:"",info:"",infoEmpty:"",infoFiltered:""},columnDefs:[{targets:[1],render:function(t,e,a){return fixNumber(t)}}],dom:"<fpt>",order:[[1,"asc"]],search:{caseInsensitive:!0},fixedColumns:{left:3},pagingType:pagingType,retrieve:!0,initComplete:function(t,e){$("#lystable").wrap("<div style='overflow:auto; width:100%;position:relative;'></div>")}}),document.getElementById("lystable_filter").childNodes[0].childNodes[1].classList.remove("form-control"),$("#lystable_filter").css("display","inline").css("float","left").css("padding-right","8px"),$("div.dataTables_filter input").keyup(function(t){0==$("#lystable").DataTable().page.len()&&$("#lystable").DataTable().page.len(8).draw()})}function changeASailTime(){var t=(currentIDHMS=event.target.getAttribute("id")).substr(currentIDHMS.length-1),e=sailTimesArray[t][0][0],a=sailTimesArray[t][0][1],i=sailTimesArray[t][0][2],e=(document.getElementById(currentIDHMS).classList.add("blinkingText"),$("#changeHour").val(e),$("#changeMinute").val(a),$("#changeSecond").val(i),$("#changeOrder").text(Number(t)+1+"."),$("#scratchDiv").get(0).getBoundingClientRect().bottom),a=Number(document.getElementById(currentIDHMS).getBoundingClientRect().left)-120;$("#sailtimeDiv").css({top:e,left:a}),$("#sailtimeDiv").show(),$("#finratingDiv").hide()}function goShow(){document.getElementById(currentIDHMS).classList.remove("blinkingText"),$("#sailtimeDiv").hide(),$("#finratingDiv").show()}function updateSailTimeArray(){var t=currentIDHMS.substr(currentIDHMS.length-1);sailTimesArray[t]=new Array([$("#changeHour").val(),$("#changeMinute").val(),$("#changeSecond").val()]),updateInputs(),goShow()}function createExcel(){var t=document.getElementById("inputTable").cloneNode(!0),t=XLSX.utils.table_to_book(t,{sheet:"scratch"}),e=(t.Sheets.scratch["!cols"]=[{width:2},{width:14},{width:20},{width:32},{width:18},{width:18},{width:18},{width:18},{width:18},{width:18}],new Date),e=(t.Props={},t.Props.Author="Avomeripurjehtijat ry 2025",t.Props.CreatedDate=e,void 0!==t.Props.SheetNames&&(t.Props.SheetNames[0]="scratch"),e.toISOString().replace(/[^0-9]/g,"").slice(0,-3));XLSX.writeFile(t,"scratch_"+e+".xlsx",{type:"file"})}function putDefaultTimes(){sailTimesArray[0]=new Array(["1","00","00"]),sailTimesArray[1]=new Array(["2","00","00"]),sailTimesArray[2]=new Array(["3","00","00"]),sailTimesArray[3]=new Array(["5","00","00"]),sailTimesArray[4]=new Array(["8","00","00"]),sailTimesArray[5]=new Array(["12","00","00"])}function fixNumber(t){return isNaN(t)?t:Number(t).toFixed(4)}function addBoat(t){boats.set(getUniqueID(),t),$("#scratchDiv").show(),updateInputs()}function removeBoat(t){boats.delete(t),0==boats.size?$("#scratchDiv").hide():updateInputs()}function updateInputs(){var l,r,t=sortBoats(boats);void 0!==(currentDefaultBoat=$("input:radio[name=defaultBoat]:checked").val())&&void 0!==boats.get(currentDefaultBoat)||(currentDefaultBoat=t.keys().next().value),0<boats.size&&calculate(),null!=inputTableJS&&inputTableJS.clear().destroy(),$("#inputTable tbody tr").remove();for([l,r]of t){let t="",e="",a=!0,i=(l==currentDefaultBoat&&(t="checked=checked",e=' style="font-weight: bold"',a=!1),'<tr><td><input type="submit" onclick="removeBoat(\''+l+'\')" value="-">'),n=(i=(i=(i=(i+='<input type="radio" value="'+l+'" name="defaultBoat"'+t+"></td>")+("<td"+e+">"+fixNumber(r.FIN_FinRating_TOT)+'<span class="scratcSpacer">('+r.C_TYPE+")</span></td>"))+("<td"+e+">"+r.TYPE.slice(0,maxNameWidth)+"</td>"))+("<td"+e+">"+r.NAME.slice(0,maxNameWidth)+"</td>"),0);for(time of r.times)i=a?showtime?(i+="<td>"+time[1]+time[2]+"</td>")+'<td style="display:none;">('+time[0]+")</td>":(i+="<td>&ensp;"+time[0]+"</td>")+'<td style="display:none;">('+time[1]+time[2]+")</td>>":i+("<td"+e+' name="sailtimeCh" id="hms'+n+'">&ensp;'+time[0])+'</td><td style="display:none;"></td>',++n;i+="</tr>",$("#inputTable tbody").append(i)}inputTableJS=$("#inputTable").DataTable({dom:"<t>",retrieve:!0,ordering:!1,fixedColumns:{left:3},initComplete:function(t,e){$("#inputTable").wrap("<div style='overflow:auto; width:100%;position:relative;'></div>")}})}$(document).ready(function(){startup()});let toHHMMSS=t=>{t=parseInt(t,10);return[Math.floor(t/3600),Math.floor(t/60)%60,t%60].map(t=>t<10?"0"+t:t).join(":")};function sortBoats(t){return new Map([...boats].sort(([,t],[,e])=>t.FIN_FinRating_TOT>e.FIN_FinRating_TOT?1:t.FIN_FinRating_TOT<e.FIN_FinRating_TOT?-1:0))}function getUniqueID(){let e=(t=1)=>Array(t).fill().map(t=>String.fromCharCode(Math.floor(26*Math.random())+65)).join(""),a=(t=1)=>Array(t).fill().map(t=>Math.floor(10*Math.random())).join("");var t=(()=>{let t=e(4)+a(6);for(;existingIDs.includes(t);)t=e(4)+a(6);return t})();return existingIDs.push(t),t}function calculate(){if(0==boats.size)alert("Valitse veneet");else{$("#createExcel").show();var n=[];for(let i=0;i<sailTimesArray.length;i++){var l=sailTimesArray[i][0];let t=l[0],e=l[1],a=l[2];null==t.match(/^[0-9]+$/)&&(t="00"),null==e.match(/^[0-9]+$/)&&(e="00"),null==a.match(/^[0-9]+$/)&&(a="00");l=t+":"+e+":"+a;(l="00:00:00"===l?null:l)&&n.push(l.split(":").reduce((t,e)=>60*t+ +e))}sailTimesLength=n.length;var t,e,a=boats.get(currentDefaultBoat).FIN_FinRating_TOT;for([t,e]of boats){var i=e.FIN_FinRating_TOT,r=[];for(sailtime of n){var o=Math.floor(sailtime),s=Math.floor(o+a*o/i-o),u=s*i;let t=Math.floor(s-o),e="&plus;";s<o&&(t=o-s,e="&minus;"),0==t&&(e="&nbsp;&nbsp; ");o=[];o.push(toHHMMSS(s)),o.push(e),o.push(toHHMMSS(t)),o.push(toHHMMSS(u)),r.push(o)}e.times=r}}}function reloadTable(){let t=setInterval(function(){void 0!==lystableJS&&(clearInterval(t),lystableJS.clear(),lystableJS.rows.add(boatlist),lystableJS.draw(),$("#waitPlease").hide())},10)}